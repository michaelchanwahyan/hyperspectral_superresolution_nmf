close all
%clear
clc

%i = 200 ;
%j = 500 ;

%i = 540 ;
%j = 820 ;

%i = 750 ;
%j = 390 ;

i = 673 ;
j = 104 ;

if( ~exist( 'HSI' , 'var' ) )
    load HSI_chikusei2014_1000x1000
end
a_true = permute( HSI(i,j,:) , [3,1,2] ) ;

figure ; imshow( imread( 'chikusei_RGB.png' ) ) ;

fid = figure ; hold on ;

cd SNR_40dB/trial0001
    load( 'LOG_CNMF_subprobIt_100_convth_1em2'         , 'A_CNMF'   , 'S_CNMF'   ) ; a_CNMF   = A_CNMF   * S_CNMF(   : , j*1000+i ) ;
    load( 'LOG_MFbA_fista_subprobIt_1'                 , 'A_MF'     , 'S_MF'     ) ; a_FISTA  = A_MF     * S_MF(     : , j*1000+i ) ;
    %load( 'LOG_DRFUMI_subprobVar_-2'                   , 'A_DRFUMI' , 'S_DRFUMI' ) ; a_DRFUMI = A_DRFUMI * S_DRFUMI( : , j*1000+i ) ;
    load( 'LOG_MFbA_FW_subprobIt_1'                    , 'A_MF'     , 'S_MF'     ) ; a_FW     = A_MF     * S_MF(     : , j*1000+i ) ;
    %load( 'LOG_FUMI_subprobVar_-2'                     , 'A_FUMI'   , 'S_FUMI'   ) ; a_FUMI   = A_FUMI   * S_FUMI(   : , j*1000+i ) ;
    load( 'LOG_MFbA_HYBRID_S_FW1_A_FISTA1_subprobIt_1' , 'A_MF'     , 'S_MF'     ) ; a_HYBRID = A_MF     * S_MF(     : , j*1000+i ) ;
cd ../..

wavelength = [363,368.157480314961,373.314960629921,378.472440944882,383.629921259843,388.787401574803,393.944881889764,399.102362204724,404.259842519685,409.417322834646,414.574803149606,419.732283464567,424.889763779528,430.047244094488,435.204724409449,440.362204724410,445.519685039370,450.677165354331,455.834645669291,460.992125984252,466.149606299213,471.307086614173,476.464566929134,481.622047244094,486.779527559055,491.937007874016,497.094488188976,502.251968503937,507.409448818898,512.566929133858,517.724409448819,522.881889763780,528.039370078740,533.196850393701,538.354330708662,543.511811023622,548.669291338583,553.826771653543,558.984251968504,564.141732283465,569.299212598425,574.456692913386,579.614173228346,584.771653543307,589.929133858268,595.086614173228,600.244094488189,605.401574803150,610.559055118110,615.716535433071,620.874015748032,626.031496062992,631.188976377953,636.346456692913,641.503937007874,646.661417322835,651.818897637795,656.976377952756,662.133858267717,667.291338582677,672.448818897638,677.606299212598,682.763779527559,687.921259842520,693.078740157480,698.236220472441,703.393700787402,708.551181102362,713.708661417323,718.866141732284,724.023622047244,729.181102362205,734.338582677165,739.496062992126,744.653543307087,749.811023622047,754.968503937008,760.125984251969,765.283464566929,770.440944881890,775.598425196850,780.755905511811,785.913385826772,791.070866141732,796.228346456693,801.385826771654,806.543307086614,811.700787401575,816.858267716536,822.015748031496,827.173228346457,832.330708661417,837.488188976378,842.645669291339,847.803149606299,852.960629921260,858.118110236220,863.275590551181,868.433070866142,873.590551181102,878.748031496063,883.905511811024,889.062992125984,894.220472440945,899.377952755906,904.535433070866,909.692913385827,914.850393700787,920.007874015748,925.165354330709,930.322834645669,935.480314960630,940.637795275591,945.795275590551,950.952755905512,956.110236220472,961.267716535433,966.425196850394,971.582677165354,976.740157480315,981.897637795276,987.055118110236,992.212598425197,997.370078740158,1002.52755905512,1007.68503937008,1012.84251968504,1018] ;

plot( wavelength , a_true   , 'k' ) ;
plot( wavelength , a_CNMF   , 'b' ) ;
plot( wavelength , a_FISTA  , 'r' ) ;
plot( wavelength , a_FW     , 'm' ) ;
plot( wavelength , a_HYBRID , 'g' ) ;
legend( 'Ground Truth' , 'CNMF' , 'ALGO-FISTA' , 'ALGO-FW' , 'ALGO-HYBRID' , 'Location' , 'best' ) ;

w = wavelength( 18: 31) ; outside = plot( w , 0.3*ones(1,length(w)) , 'b-' , 'LineWidth' , 3 ) ; ylim([0,0.35]) ; set(outside,'Clipping','off') ;
w = wavelength( 32: 46) ; outside = plot( w , 0.3*ones(1,length(w)) , 'b-' , 'LineWidth' , 3 ) ; ylim([0,0.35]) ; set(outside,'Clipping','off') ;
w = wavelength( 53: 64) ; outside = plot( w , 0.3*ones(1,length(w)) , 'b-' , 'LineWidth' , 3 ) ; ylim([0,0.35]) ; set(outside,'Clipping','off') ;
w = wavelength( 78:105) ; outside = plot( w , 0.3*ones(1,length(w)) , 'b-' , 'LineWidth' , 3 ) ; ylim([0,0.35]) ; set(outside,'Clipping','off') ;
    text(450,0.32,'Multispectral bands'   , ...
    'VerticalAlignment'  ,'bottom' , ...
    'HorizontalAlignment','left'   , ...
    'FontSize'           ,10       ) ;
xlabel( 'Wavelength (nm)' ) ;
ylabel( 'reflectance' ) ;
title( sprintf( 'Spectral plot at %d^{th} pixel' , j*1000+i ) ) ;
